#!/usr/bin/env python
"""Publish coverage results online via coveralls.io

Usage:
    coveralls [options]
    coveralls report [options]
    coveralls debug  [options]

Global options:
    -h --help       Display this help
    -v --verbose    Print extra info, True for debug command
"""
import logging
import pprint
from docopt import docopt
from coveralls import Coveralls


log = logging.getLogger(__name__)


if __name__ == '__main__':
    options = docopt(__doc__)
    if options['debug']:
        options['--verbose'] = True
    level = logging.DEBUG if options['--verbose'] else logging.INFO
    log.addHandler(logging.StreamHandler())
    log.setLevel(level)

    coverallz = Coveralls()
    if options['--verbose']:
        log.debug('Submitting this (sources excluded for brevity):')
        data = coverallz.create_data().copy()
        data.pop('source_files')
        log.debug(pprint.pformat(data))
    if not options['debug']:
        log.info("Submitting coverage to coveralls.io...")
        result = coverallz.wear()
        log.info("Coverage submitted!")
        log.info(result['message'])
        log.info(result['url'])